Hereâ€™s a concise yet comprehensive guide for managing **Node.js apps using PM2**:

---

## **1. Install PM2**

```bash
npm install -g pm2
```

---

## **2. Start / Stop / Restart Apps**

### Start

```bash
pm2 start app.js          # Simple start
pm2 start app.js --name my-app   # Start with a custom name
pm2 start app.js --watch  # Auto-restart on file changes
```

### Stop

```bash
pm2 stop my-app
pm2 stop all              # Stop all PM2 processes
```

### Restart

```bash
pm2 restart my-app
pm2 restart all           # Restart all processes
```

---

## **3. Auto-Restart on Crash**

PM2 automatically restarts apps if they crash. No extra setup is needed.

Optional: limit restarts

```bash
pm2 start app.js --max-restarts 5
```

---

## **4. Environment Variables**

Set environment variables when starting the app:

```bash
pm2 start app.js --name my-app --env PORT=3000 --env NODE_ENV=production
```

Use **ecosystem.config.js** for multiple environments:

```javascript
module.exports = {
  apps: [{
    name: "my-app",
    script: "./app.js",
    env: {
      NODE_ENV: "development",
      PORT: 3000
    },
    env_production: {
      NODE_ENV: "production",
      PORT: 8000
    }
  }]
}
```

Start with:

```bash
pm2 start ecosystem.config.js --env production
```

---

## **5. Log Viewing**

```bash
pm2 logs my-app       # View logs of a single app
pm2 logs              # View all logs
pm2 flush             # Clear all logs
pm2 monit             # Live process monitoring
```

---

## **6. Generating Startup Scripts**

Enable PM2 to restart on server reboot:

```bash
pm2 startup           # Detect your OS and generate startup script
pm2 save              # Save current process list for auto-start
```

---

## **7. Common Errors & Recovery**

* **App not starting:** check logs `pm2 logs my-app`.
* **Port already in use:** change port in env or kill process using `lsof -i :PORT`.
* **PM2 daemon not running:** restart PM2 `pm2 kill && pm2 resurrect`.
* **Memory leaks / high usage:** monitor with `pm2 monit` and consider `pm2 restart --max-memory-restart 200M app`.

---

This setup ensures **reliable Node.js deployment** with auto-restarts, environment management, and easy monitoring.

---

If you want, I can also make a **1-page cheat sheet** with **all commands ready to copy-paste**, which is super handy for server management. Do you want me to do that?
